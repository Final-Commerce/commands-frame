# addCustomSale

Adds a custom sale item to the cart in the parent window. This is useful for adding non-product items like service fees, discounts, or custom charges.

## Parameters

### `AddCustomSaleParams`

```typescript
interface AddCustomSaleParams {
    label: string;           // Required
    price: number | string; // Required
    applyTaxes?: boolean;   // Optional, default: false
}
```

#### `label` (required)

The label or name for the custom sale item. This will be displayed in the cart.

**Example:**
- "Service Fee"
- "Delivery Charge"
- "Custom Item"
- "Discount"

#### `price` (required)

The price of the custom sale item. Can be provided as:
- A number (e.g., `10.50`)
- A string (e.g., `"10.50"`)

The price will be converted to a number internally. Negative values can be used for discounts.

#### `applyTaxes` (optional)

Whether to apply taxes to the custom sale item. Defaults to `false` if not provided.

- `true`: Taxes will be calculated and applied to this item
- `false`: No taxes will be applied (default)

## Response

### `AddCustomSaleResponse`

```typescript
interface AddCustomSaleResponse {
    success: boolean;
    label: string;
    price: number;
    applyTaxes: boolean;
    timestamp: string;
}
```

#### `success` (boolean)

Indicates whether the custom sale was successfully added to the cart.

#### `label` (string)

The label that was used for the custom sale (echoed back from the request).

#### `price` (number)

The price of the custom sale as a number (converted from string if provided).

#### `applyTaxes` (boolean)

Whether taxes are applied to this custom sale item.

#### `timestamp` (string)

ISO 8601 timestamp string (e.g., `"2024-01-01T00:00:00.000Z"`) indicating when the response was generated by the handler.

## Usage

```typescript
import { commands } from '@final-commerce/commands-frame';
```

## Usage Examples

### Basic Custom Sale

Add a simple custom sale item without taxes:

```typescript
import { commands } from '@final-commerce/commands-frame';

const result = await commands.addCustomSale({
    label: 'Service Fee',
    price: 5.00
});

console.log('Added:', result.label, 'for $', result.price);
```

### Custom Sale with Taxes

Add a custom sale item with taxes applied:

```typescript
const result = await commands.addCustomSale({
    label: 'Delivery Charge',
    price: 10.50,
    applyTaxes: true
});
```

### Discount (Negative Price)

Add a discount as a custom sale:

```typescript
const result = await commands.addCustomSale({
    label: 'Loyalty Discount',
    price: -5.00,  // Negative for discount
    applyTaxes: false
});
```

### Price as String

Provide price as a string (will be converted to number):

```typescript
const result = await commands.addCustomSale({
    label: 'Custom Item',
    price: '15.99',  // String format
    applyTaxes: true
});
```

### Error Handling

Handle validation errors:

```typescript
try {
    const result = await commands.addCustomSale({
        label: '',  // Empty label
        price: 10
    });
} catch (error) {
    if (error.message === 'Label and price are required') {
        console.error('Please provide both label and price');
    } else if (error.message === 'Parameters are required for addCustomSale') {
        console.error('Please provide parameters');
    } else {
        console.error('Failed to add custom sale:', error.message);
    }
}
```

### Complete Example

Complete workflow with error handling:

```typescript
async function addServiceFee(amount: number) {
    try {
        const result = await commands.addCustomSale({
            label: 'Service Fee',
            price: amount,
            applyTaxes: true
        });
        
        if (result.success) {
            console.log(`Service fee of $${result.price} added successfully`);
            return result;
        }
    } catch (error) {
        console.error('Failed to add service fee:', error);
        throw error;
    }
}

// Usage
await addServiceFee(5.50);
```

## Behavior

When a custom sale is added:

1. The item is validated (label and price must be provided)
2. The item is added to the current cart in the parent application
3. The quantity is set to 1 by default
4. Taxes are applied if `applyTaxes` is `true`
5. The item appears in the cart with the specified label and price

## Error Handling

The handler will throw errors in the following cases:

### Missing Parameters

```typescript
// Throws: "Parameters are required for addCustomSale"
await commands.addCustomSale();
```

### Missing Label or Price

```typescript
// Throws: "Label and price are required"
await commands.addCustomSale({
    label: 'Fee'
    // Missing price
});
```

### Error Response Format

```typescript
try {
    const result = await commands.addCustomSale({
        label: 'Test',
        price: 10
    });
} catch (error) {
    // error.message contains the error description
    console.error(error.message);
}
```

## Validation Rules

- `label` must be a non-empty string
- `price` must be provided and can be a number or string representation of a number
- `applyTaxes` is optional and defaults to `false`
- Price can be negative (for discounts)
- Price will be converted to a number internally (strings are parsed)

## Real Data Examples

### Example Response

```json
{
  "success": true,
  "label": "Custom Item",
  "price": 10,
  "applyTaxes": false,
  "timestamp": "2025-12-04T19:24:13.293Z"
}
```

### Example Request

```json
{
  "label": "Custom Item",
  "price": 10,
  "applyTaxes": false
}
```

## Notes

- The custom sale is added to the current active cart/session
- The quantity is always set to 1
- The item is immediately available in the cart after successful addition
- Custom sales are treated as regular cart items and can be removed or modified like other items
- If taxes are applied, they are calculated based on the current tax settings in the parent application

