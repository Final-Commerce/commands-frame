# addCustomer

Adds a new customer to the local database in the parent application.

## Parameters

### `AddCustomerParams`

```typescript
interface AddCustomerParams {
    customer: Record<string, any>;
}
```

#### `customer` (required)

The customer object to create. The type is `Record<string, any>` to allow flexibility between different database implementations. Only `email` is required; all other fields are optional.

**Typical customer structure:**

**Required fields:**

- `email` (string): Customer email address. Must be unique and valid.

**Optional fields:**

- `firstName` (string): Customer's first name.
- `lastName` (string): Customer's last name.
- `phone` (string): Customer's phone number.
- `tags` (string[]): Array of tags to associate with the customer.
- `metadata` (Array<{ key: string; value: string }>): Custom metadata as key-value pairs.
- `notes` (Array<{ createdAt: Date | string; message: string }>): Array of notes associated with the customer.
- `billing` (object): Billing address information (see Address Structure below).
- `shipping` (object): Shipping address information (see Address Structure below).
- `totalSpent` (string): Total amount the customer has spent.
- `lastAction` (Date | string): Timestamp of the customer's last action.
- `outletId` (string): ID of the outlet associated with the customer.
- `externalId` (string): External system identifier.
- `fromOliver` (boolean): Indicates if the customer originated from Oliver system.

### Address Structure

Both `billing` and `shipping` follow the address structure shown in the [Real Data Examples](#real-data-examples) section below.

### Metadata Structure

Metadata is an array of key-value pairs. See the [Real Data Examples](#real-data-examples) section below for actual examples.

### Notes Structure

Notes is an array of timestamped messages. See the [Real Data Examples](#real-data-examples) section below for actual examples.

## Response

### `AddCustomerResponse`

```typescript
interface AddCustomerResponse {
    success: boolean;
    customer: any;
    timestamp: string;
}
```

#### `success` (boolean)

Indicates whether the customer was successfully created.

#### `customer` (any)

The created customer object, including all fields from the request plus automatically generated fields. The structure depends on the database implementation:
- `id` or `_id`: ID field (structure depends on database - MongoDB uses `_id`, LokiJS/IndexedDB may use `id`)
- `createdAt`: Creation timestamp
- `updatedAt`: Last update timestamp
- `fromOliver`: Default value based on system configuration (if not provided)

The customer object is returned as `any` to allow flexibility between different database implementations.

#### `timestamp` (string)

ISO 8601 timestamp string (e.g., `"2024-01-01T00:00:00.000Z"`) indicating when the response was generated by the handler.

## Usage

```typescript
import { commands } from '@final-commerce/commands-frame';
```

## Usage Examples

### Create Customer

Create a customer with basic information:

```typescript
import { commands } from '@final-commerce/commands-frame';

const result = await commands.addCustomer({
    customer: {
        email: 'newcustomer.test@example.com',
        firstName: 'John',
        lastName: 'Doe',
        phone: '1234567890'
    }
});

console.log(result.customer);
```

## Error Handling

If the customer creation fails, the handler will throw an error. Common error scenarios include missing `customer` object, invalid email format, or duplicate email.

## Validation Rules

- `email` is required and must be a valid email format
- `billing.address1`, `billing.city`, `billing.state`, `billing.country`, and `billing.postCode` are required if `billing` is provided
- `shipping.address1`, `shipping.city`, `shipping.state`, `shipping.country`, and `shipping.postCode` are required if `shipping` is provided
- `metadata` items must have both `key` and `value` as strings
- `notes` items must have both `createdAt` and `message` fields

## Real Data Examples

### Example Response

```json
{
  "success": true,
  "customer": {
    "firstName": "John",
    "lastName": "Doe",
    "email": "newcustomer.test@example.com",
    "phone": "1234567890",
    "_id": "6931e04f53d9113bd5231dfd",
    "createdAt": "2025-12-04T19:26:07.316Z",
    "updatedAt": "2025-12-04T19:26:07.316Z"
  },
  "timestamp": "2025-12-04T19:26:07.316Z"
}
```

### Example Request

```json
{
  "customer": {
    "firstName": "John",
    "lastName": "Doe",
    "email": "newcustomer.test@example.com",
    "phone": "1234567890"
  }
}
```

## Notes

- The customer is created in the local IndexedDB database (LokiJS)
- Generated fields (ID field, `createdAt`, `updatedAt`) are automatically added
- The ID field structure depends on the database implementation (may be `id`, `_id`, or other formats)
- The `fromOliver` field defaults based on the system configuration
- Customer data is synchronized with the central MongoDB database via station-sync

