# assignCustomer

Assigns an existing customer to the current active session/cart in the parent application.

## Parameters

### `AssignCustomerParams`

```typescript
interface AssignCustomerParams {
    customerId: string;  // Required
}
```

#### `customerId` (required)

The ID of the customer to assign to the current session. Can be either:
- MongoDB ObjectId string (e.g., `"507f1f77bcf86cd799439011"`)
- Alternative ID string if the customer object uses an `id` field

## Response

### `AssignCustomerResponse`

```typescript
interface AssignCustomerResponse {
    success: boolean;
    customer: Customer;
    timestamp: string;
}
```

#### `success` (boolean)

Indicates whether the customer was successfully assigned to the session.

#### `customer` (Customer)

The customer object that was assigned to the session. This is the complete customer record retrieved from the database, including all customer fields:

```typescript
interface Customer {
    _id?: string;
    id?: string;
    companyId?: string;
    externalId?: string;
    email: string;
    firstName?: string;
    lastName?: string;
    phone?: string;
    tags?: string[];
    metadata?: CustomerMetadata[];
    notes?: CustomerNote[];
    billing?: AddressDto;
    shipping?: AddressDto;
    totalSpent?: string;
    lastAction?: Date | string;
    outletId?: string;
    fromOliver: boolean;
    isDeleted?: boolean;
    createdAt?: Date | string;
    updatedAt?: Date | string;
}
```

#### `timestamp` (string)

ISO 8601 timestamp string (e.g., `"2024-01-01T00:00:00.000Z"`) indicating when the response was generated by the handler.

## Usage

```typescript
import { commands } from '@final-commerce/commands-frame';
```

## Usage Examples

### Basic Assignment

Assign a customer to the current session:

```typescript
import { commands } from '@final-commerce/commands-frame';

const result = await commands.assignCustomer({
    customerId: '507f1f77bcf86cd799439011'
});

console.log(result.customer);
console.log('Customer assigned:', result.success);
```

### Assign Customer from Search Results

Find a customer first, then assign them:

```typescript
// First, search for the customer
const searchResult = await commands.getCustomers({
    query: {
        email: 'john.doe@example.com'
    }
});

if (searchResult.customers.length > 0) {
    const customer = searchResult.customers[0];
    const customerId = customer._id || customer.id;
    
    // Assign the found customer
    const assignResult = await commands.assignCustomer({
        customerId: customerId!
    });
    
    console.log('Assigned customer:', assignResult.customer.firstName);
}
```

### Error Handling

Handle cases where the customer is not found:

```typescript
try {
    const result = await commands.assignCustomer({
        customerId: 'invalid-id'
    });
} catch (error) {
    if (error.message === 'Customer not found') {
        console.error('Customer does not exist');
    } else if (error.message === 'customerId is required') {
        console.error('Please provide a customer ID');
    } else {
        console.error('Failed to assign customer:', error.message);
    }
}
```

### Complete Workflow Example

Complete example of creating and assigning a customer:

```typescript
// Step 1: Check if customer exists
const searchResult = await commands.getCustomers({
    query: {
        email: 'newcustomer@example.com'
    }
});

let customerId: string;

if (searchResult.customers.length > 0) {
    // Customer exists, use their ID
    customerId = searchResult.customers[0]._id || searchResult.customers[0].id!;
} else {
    // Create new customer
    const newCustomer = await commands.addCustomer({
        customer: {
            email: 'newcustomer@example.com',
            firstName: 'New',
            lastName: 'Customer'
        }
    });
    customerId = newCustomer.customer._id || newCustomer.customer.id!;
}

// Step 2: Assign customer to session
const assignResult = await commands.assignCustomer({
    customerId: customerId
});

console.log('Session customer:', assignResult.customer);
```

## Behavior

When a customer is assigned:

1. The customer is retrieved from the local database
2. The customer is set as the active customer in the Redux store
3. The customer information becomes available for the current session/cart
4. Any subsequent operations (orders, transactions) will be associated with this customer

## Error Handling

The handler will throw errors in the following cases:

### Missing customerId

```typescript
// Throws: "customerId is required"
await commands.assignCustomer({});
```

### Customer Not Found

```typescript
// Throws: "Customer not found"
await commands.assignCustomer({
    customerId: 'non-existent-id'
});
```

### Error Response Format

```typescript
try {
    const result = await commands.assignCustomer({
        customerId: 'some-id'
    });
} catch (error) {
    // error.message contains the error description
    console.error(error.message);
}
```

## Notes

- The customer must exist in the local database before assignment
- Deleted customers (`isDeleted: true`) cannot be assigned
- The assignment updates the active customer in the Redux store
- The customer ID can be either `_id` (MongoDB ObjectId) or `id` (alternative ID field)
- After assignment, the customer is available for the current session until a new customer is assigned or the session is cleared

