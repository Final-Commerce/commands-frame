# getCategories

Retrieves a list of categories from the parent application's local database.

## Parameters

### `GetCategoriesParams`

```typescript
interface GetCategoriesParams {
    query?: {
        // MongoDB query fields
        name?: string | { $regex?: string; $options?: string };
        parentId?: string | null;
        externalId?: string;
        [key: string]: any;
    };
}
```

#### `query` (optional)

A MongoDB query object to filter categories.

**Supported query fields:**

- `name` (string | regex): Filter by category name. Supports regex for partial matches.
- `parentId` (string | null): Filter by parent category ID. Use `null` to get top-level categories.
- `externalId` (string): Filter by external system ID.
- Additional MongoDB query operators are supported (e.g., `$ne`, `$gt`, `$lt`, etc.)

**Note:** The handler automatically excludes deleted categories (`isDeleted: { $ne: true }`).

## Response

### `GetCategoriesResponse`

```typescript
interface GetCategoriesResponse {
    categories: any[];
    timestamp: string;
}
```

#### `categories` (any[])

Array of category objects matching the query. The actual structure may vary depending on the database implementation (MongoDB/mongoose vs LokiJS/IndexedDB). See the [Real Data Examples](#real-data-examples) section below for actual category object structures.

#### `timestamp` (string)

ISO 8601 timestamp string (e.g., `"2024-01-01T00:00:00.000Z"`) indicating when the response was generated by the handler.

## Usage

```typescript
import { commands } from '@final-commerce/commands-frame';
```

## Usage Examples

### Basic Query

Get all categories:

```typescript
import { commands } from '@final-commerce/commands-frame';

const result = await commands.getCategories();
console.log(result.categories);
```

### Search by Name

Find categories by name:

```typescript
const result = await commands.getCategories({
    query: {
        name: { $regex: 'electronics', $options: 'i' }
    }
});
```

### Get Top-Level Categories

Get only categories without a parent:

```typescript
const result = await commands.getCategories({
    query: {
        parentId: null
    }
});
```

### Get Subcategories

Get categories for a specific parent:

```typescript
const result = await commands.getCategories({
    query: {
        parentId: 'parent-category-id'
    }
});
```

### Filter by External ID

Get category by external system ID:

```typescript
const result = await commands.getCategories({
    query: {
        externalId: 'external-id-123'
    }
});
```

### Combined Filters

Combine multiple filters:

```typescript
const result = await commands.getCategories({
    query: {
        parentId: null,
        name: { $regex: 'electronics', $options: 'i' }
    }
});
```

## Real Data Examples

### Example Response

```json
{
  "categories": [
    {
      "_id": "693086eda7030296aecd3b9e",
      "name": "Test category",
      "parentId": null,
      "externalId": null
    },
    {
      "_id": "691df9c6c478bada1fb23d29",
      "name": "cool stuff",
      "parentId": null,
      "externalId": null
    },
    {
      "_id": "693199552d793b4388bcfd90",
      "name": "Coffee",
      "parentId": null,
      "externalId": null
    }
  ],
  "timestamp": "2025-12-04T19:24:13.293Z"
}
```

### Example Category Object

```json
{
  "_id": "693199552d793b4388bcfd90",
  "name": "Coffee",
  "parentId": null,
  "externalId": null
}
```

## Category Structure Reference

The category structure may vary depending on the database implementation. The structure shown above is a reference based on MongoDB schemas. In practice, category objects are returned as `any` to allow flexibility between different database implementations (MongoDB/mongoose vs LokiJS/IndexedDB).

Key fields that may be present:

- **Hierarchy**: Categories can have a parent-child relationship via `parentId`.
- **ID fields**: The ID field structure depends on the database (may be `id`, `_id`, or other formats).

## Error Handling

If the query fails or no categories are found, the handler returns an empty array:

```typescript
{
    categories: [],
    timestamp: "2024-01-01T00:00:00.000Z"
}
```

## Notes

- Deleted categories (`isDeleted: true`) are automatically excluded
- The query supports standard MongoDB query operators
- Categories can be organized in a hierarchical structure using `parentId`

