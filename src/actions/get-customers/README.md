# getCustomers

Retrieves a list of customers from the parent application's local database.

## Parameters

### `GetCustomersParams`

```typescript
interface GetCustomersParams {
    query?: {
        // MongoDB query fields
        email?: string | { $regex?: string; $options?: string };
        firstName?: string | { $regex?: string; $options?: string };
        lastName?: string | { $regex?: string; $options?: string };
        phone?: string | { $regex?: string; $options?: string };
        tags?: string | { $in?: string[] };
        outletId?: string;
        [key: string]: any;
    };
}
```

#### `query` (optional)

A MongoDB query object to filter customers. The handler supports text search across `firstName`, `lastName`, `email`, and `phone` fields when using the query object.

**Supported query fields:**

- `email` (string | regex): Filter by email address. Supports regex for partial matches.
- `firstName` (string | regex): Filter by first name. Supports regex for partial matches.
- `lastName` (string | regex): Filter by last name. Supports regex for partial matches.
- `phone` (string | regex): Filter by phone number. Supports regex for partial matches.
- `tags` (string | array): Filter by tags. Use `{ $in: ['tag1', 'tag2'] }` for multiple tags.
- `outletId` (string): Filter by outlet ID.
- Additional MongoDB query operators are supported (e.g., `$ne`, `$gt`, `$lt`, etc.)

**Note:** The handler automatically excludes deleted customers (`isDeleted: { $ne: true }`) and limits results to 100 items by default.

## Response

### `GetCustomersResponse`

```typescript
interface GetCustomersResponse {
    customers: Customer[];
    total?: number;
    timestamp: string;
}
```

#### `customers` (Customer[])

Array of customer objects matching the query. Each customer object contains the following fields:

```typescript
interface Customer {
    _id?: string;              // MongoDB ObjectId
    id?: string;                // Alternative ID field
    companyId?: string;         // Company identifier
    externalId?: string;        // External system ID
    email: string;              // Required: Customer email
    firstName?: string;         // First name
    lastName?: string;          // Last name
    phone?: string;             // Phone number
    tags?: string[];            // Customer tags
    metadata?: CustomerMetadata[]; // Custom metadata
    notes?: CustomerNote[];     // Customer notes
    billing?: AddressDto;      // Billing address
    shipping?: AddressDto;      // Shipping address
    totalSpent?: string;        // Total amount spent
    lastAction?: Date | string; // Last action timestamp
    outletId?: string;          // Associated outlet ID
    fromOliver: boolean;        // Source indicator
    isDeleted?: boolean;        // Deletion flag
    createdAt?: Date | string;  // Creation timestamp
    updatedAt?: Date | string;  // Last update timestamp
}
```

#### `total` (number, optional)

Total number of customers matching the query (before pagination). This count includes all matching customers, not just those returned in the `customers` array (which is limited to 100 items).

#### `timestamp` (string)

ISO 8601 timestamp string (e.g., `"2024-01-01T00:00:00.000Z"`) indicating when the response was generated by the handler.

## Usage

```typescript
import { commands } from '@final-commerce/commands-frame';
```

## Usage Examples

### Basic Query

Get all customers (up to 100):

```typescript
import { commands } from '@final-commerce/commands-frame';

const result = await commands.getCustomers();
console.log(result.customers);
```

### Search by Email

Find customers with a specific email domain:

```typescript
const result = await commands.getCustomers({
    query: {
        email: { $regex: '@example.com', $options: 'i' }
    }
});
```

### Filter by Tags

Find customers with specific tags:

```typescript
const result = await commands.getCustomers({
    query: {
        tags: { $in: ['vip', 'premium'] }
    }
});
```

### Search by Name

Find customers by first or last name:

```typescript
const result = await commands.getCustomers({
    query: {
        firstName: { $regex: 'John', $options: 'i' }
    }
});
```

### Combined Filters

Combine multiple filters:

```typescript
const result = await commands.getCustomers({
    query: {
        outletId: 'outlet-123',
        tags: { $in: ['vip'] }
    }
});
```

## Customer Schema Reference

The customer structure is based on the MongoDB schema defined in `station-sync/src/station-sync/schemas/customer.schema.ts`. Key fields:

- **Address fields**: `billing` and `shipping` follow the `AddressDto` structure with `address1`, `city`, `state`, `country`, `postCode`, etc.
- **Metadata**: Array of key-value pairs for custom data.
- **Notes**: Array of timestamped messages associated with the customer.

## Error Handling

If the query fails or no customers are found, the handler returns an empty array:

```typescript
{
    customers: [],
    total: 0,
    timestamp: "2024-01-01T00:00:00.000Z"
}
```

## Notes

- Results are limited to 100 customers per request
- Deleted customers (`isDeleted: true`) are automatically excluded
- Text search is performed across `firstName`, `lastName`, `email`, and `phone` fields
- The query supports standard MongoDB query operators

