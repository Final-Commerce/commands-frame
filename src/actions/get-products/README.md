# getProducts

Retrieves a list of products from the parent application's local database.

## Parameters

### `GetProductsParams`

```typescript
interface GetProductsParams {
    query?: {
        // MongoDB query fields
        name?: string | { $regex?: string; $options?: string };
        sku?: string | { $regex?: string; $options?: string };
        status?: string;
        productType?: string;
        categories?: string | { $in?: string[] };
        tags?: string | { $in?: string[] };
        supplier?: string;
        externalId?: string;
        [key: string]: any;
    };
}
```

#### `query` (optional)

A MongoDB query object to filter products. The handler supports text search across `name` and `sku` fields when using the query object.

**Supported query fields:**

- `name` (string | regex): Filter by product name. Supports regex for partial matches.
- `sku` (string | regex): Filter by SKU. Supports regex for partial matches.
- `status` (string): Filter by product status (e.g., 'active', 'inactive', 'draft').
- `productType` (string): Filter by product type (e.g., 'simple', 'variable', 'grouped').
- `categories` (string | array): Filter by category IDs. Use `{ $in: ['cat1', 'cat2'] }` for multiple categories.
- `tags` (string | array): Filter by tags. Use `{ $in: ['tag1', 'tag2'] }` for multiple tags.
- `supplier` (string): Filter by supplier name.
- `externalId` (string): Filter by external system ID.
- Additional MongoDB query operators are supported (e.g., `$ne`, `$gt`, `$lt`, etc.)

**Note:** The handler automatically excludes deleted products (`isDeleted: { $ne: true }`) and limits results to 100 items by default.

## Response

### `GetProductsResponse`

```typescript
interface GetProductsResponse {
    products: any[];
    timestamp: string;
}
```

#### `products` (any[])

Array of product objects matching the query. The actual structure may vary depending on the database implementation (MongoDB/mongoose vs LokiJS/IndexedDB). A typical product object may contain the following fields:

```typescript
// Reference structure (actual structure may vary)
interface Product {
    id?: string;                      // ID field (structure depends on database)
    companyId?: string;               // Company identifier
    externalId?: string;              // External system ID
    taxTable?: string;                // Tax table reference
    name: string;                     // Required: Product name
    description?: string;             // Full description
    shortDescription?: string;        // Short description
    images?: string[];                // Product images URLs
    categories?: string[];             // Category IDs
    attributes?: Array<{ name?: string; values: string[] }>;   // Product attributes
    tags?: string[];                  // Product tags
    supplier?: string;                // Supplier name
    metadata?: Array<{ key?: string; value?: string }>;     // Custom metadata
    fromOliver?: boolean;             // Source indicator
    sku?: string;                     // SKU code
    status?: string;                   // Product status
    productType: string;              // Required: Product type
    source?: string;                  // Source system
    outlets?: string[];               // Associated outlet IDs
    minPrice?: string;                // Minimum price
    maxPrice?: string;                // Maximum price
    isDeleted?: boolean;              // Deletion flag
    createdAt?: Date | string;       // Creation timestamp
    updatedAt?: Date | string;        // Last update timestamp
    variants?: Variant[];             // Product variants (if included)
}
```

#### `timestamp` (string)

ISO 8601 timestamp string (e.g., `"2024-01-01T00:00:00.000Z"`) indicating when the response was generated by the handler.

### Product Variants

If variants are included in the response, each product may have a `variants` array:

```typescript
// Reference structure (actual structure may vary)
interface Variant {
    id?: string;                     // ID field (structure depends on database)
    companyId?: string;               // Company identifier
    productId: string;                // Parent product ID
    allowBackorder?: boolean;         // Allow backorder flag
    attributes?: Array<{ name?: string; value?: string }>;  // Variant attributes
    barcode?: string;                 // Barcode
    externalId?: string;              // External system ID
    images: string[];                 // Variant images
    inventory?: Array<{ stock?: number; outletId?: string }>;   // Inventory per outlet
    manageStock?: boolean;           // Stock management flag
    isOnSale?: boolean;              // Sale status
    metadata?: Array<{ key?: string; value?: string }>;    // Custom metadata
    price?: string;                  // Regular price
    salePrice?: string;              // Sale price
    sku?: string;                    // Variant SKU
    costPrice?: string;              // Cost price
    isDeleted?: boolean;             // Deletion flag
    createdAt?: Date | string;      // Creation timestamp
    updatedAt?: Date | string;       // Last update timestamp
}
```

## Usage

```typescript
import { commands } from '@final-commerce/commands-frame';
```

## Usage Examples

### Basic Query

Get all products (up to 100):

```typescript
import { commands } from '@final-commerce/commands-frame';

const result = await commands.getProducts();
console.log(result.products);
```

### Search by Name

Find products by name:

```typescript
const result = await commands.getProducts({
    query: {
        name: { $regex: 'laptop', $options: 'i' }
    }
});
```

### Search by SKU

Find products by SKU:

```typescript
const result = await commands.getProducts({
    query: {
        sku: { $regex: 'LAP-', $options: 'i' }
    }
});
```

### Filter by Status

Get only active products:

```typescript
const result = await commands.getProducts({
    query: {
        status: 'active'
    }
});
```

### Filter by Product Type

Get products of a specific type:

```typescript
const result = await commands.getProducts({
    query: {
        productType: 'variable'
    }
});
```

### Filter by Category

Get products in specific categories:

```typescript
const result = await commands.getProducts({
    query: {
        categories: { $in: ['cat-id-1', 'cat-id-2'] }
    }
});
```

### Filter by Tags

Get products with specific tags:

```typescript
const result = await commands.getProducts({
    query: {
        tags: { $in: ['featured', 'bestseller'] }
    }
});
```

### Combined Filters

Combine multiple filters:

```typescript
const result = await commands.getProducts({
    query: {
        status: 'active',
        productType: 'simple',
        tags: { $in: ['featured'] }
    }
});
```

## Product Structure Reference

The product structure may vary depending on the database implementation. The structure shown above is a reference based on MongoDB schemas. In practice, product objects are returned as `any` to allow flexibility between different database implementations (MongoDB/mongoose vs LokiJS/IndexedDB).

Key fields that may be present:

- **Attributes**: Product attributes with name and values array.
- **Metadata**: Array of key-value pairs for custom data.
- **Variants**: Product variants with their own pricing, inventory, and attributes.
- **Inventory**: Variant inventory is tracked per outlet in the `inventory` array.
- **ID fields**: The ID field structure depends on the database (may be `id`, `_id`, or other formats).

## Error Handling

If the query fails or no products are found, the handler returns an empty array:

```typescript
{
    products: [],
    timestamp: "2024-01-01T00:00:00.000Z"
}
```

## Notes

- Results are limited to 100 products per request
- Deleted products (`isDeleted: true`) are automatically excluded
- Text search is performed across `name` and `sku` fields
- The query supports standard MongoDB query operators
- Variants may be included in the response depending on the handler implementation

