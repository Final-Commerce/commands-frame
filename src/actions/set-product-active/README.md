# setProductActive

Sets a product variant as the active product in the parent application. The active product can then be used for adding discounts, notes, or adding to the cart.

## Parameters

### `SetProductActiveParams`

```typescript
interface SetProductActiveParams {
    variantId: string;
}
```

#### `variantId` (required)

The ID of the variant to set as active. This should be a variant ID (not a product ID or SKU).

**Note:** You can get variant IDs by calling `getProductVariants` with a product ID, which will return all variants for that product including their IDs.

## Response

### `SetProductActiveResponse`

```typescript
interface SetProductActiveResponse {
    success: boolean;
    variantId: string;
    timestamp: string;
}
```

#### `success` (boolean)

Indicates whether the product variant was successfully set as active.

#### `variantId` (string)

The variant ID that was set as active (echoed back from the request).

#### `timestamp` (string)

ISO 8601 timestamp string (e.g., `"2024-01-01T00:00:00.000Z"`) indicating when the response was generated by the handler.

## Usage

```typescript
import { commands } from '@final-commerce/commands-frame';
```

## Usage Examples

### Set Variant as Active

Set a specific variant as the active product:

```typescript
import { commands } from '@final-commerce/commands-frame';

const result = await commands.setProductActive({
    variantId: 'variant-id-123'
});

console.log('Product set as active:', result.variantId);
```

### Complete Workflow

Typical workflow: Get variants, set one as active, then add discount or add to cart:

```typescript
// 1. Get variants for a product
const variantsResult = await commands.getProductVariants({
    productId: 'product-id-123'
});

// 2. Set the first variant as active
if (variantsResult.variants.length > 0) {
    const variantId = variantsResult.variants[0]._id || variantsResult.variants[0].id;
    
    await commands.setProductActive({
        variantId: variantId
    });
    
    // 3. Now you can add discount or add to cart
    await commands.addProductDiscount({
        amount: 10,
        isPercent: false,
        label: 'Special Discount'
    });
    
    await commands.addProductToCart({ quantity: 2 });
}
```

### Error Handling

Handle errors when variant is not found:

```typescript
try {
    const result = await commands.setProductActive({
        variantId: 'invalid-variant-id'
    });
} catch (error) {
    if (error.message.includes('not found')) {
        console.error('Variant does not exist');
    } else if (error.message === 'Variant ID is required') {
        console.error('Please provide a variant ID');
    } else {
        console.error('Failed to set product active:', error.message);
    }
}
```

## Behavior

When a variant is set as active:

1. The variant is fetched from the database along with its parent product
2. The active product state is updated in the parent application
3. The full product data (including all variants) is stored as the active full product
4. The specific variant becomes the active product with its price, stock, and other details
5. The quantity is set based on stock availability or existing cart quantity

## Prerequisites

- The variant must exist in the parent application's local database
- The variant must not be deleted (`isDeleted: { $ne: true }`)
- The parent product must exist and not be deleted

## Error Handling

The handler will throw errors in the following cases:

### Missing Variant ID

```typescript
// Throws: "Variant ID is required"
await commands.setProductActive({});
```

### Variant Not Found

```typescript
// Throws: "Variant with ID {variantId} not found"
await commands.setProductActive({
    variantId: 'non-existent-id'
});
```

### Variant Not Found in Product

```typescript
// Throws: "Variant not found in product"
// (Internal error - should not occur in normal usage)
```

## Notes

- Setting a product as active is required before adding discounts or adding to cart
- The active product state persists until a new product is set as active or the session is cleared
- Stock availability is checked when setting the product active
- If the variant is already in the cart, the quantity will be incremented by 1
- The active product includes full product information including images, description, and all variant options

